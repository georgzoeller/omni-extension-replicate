<!DOCTYPE html>
<html>
  <head>
    <style>
      html, body { margin: 0;
        width: 100%;
        height: 100%;
        min-height: 500px;
        min-width: 600px;
        overflow: hidden;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        padding:4px 4px 4px 4px;
        background-color: #9ca3af;
      }
      #app
      {
        background-color: white;
        background-size:cover;

      }
      .content {
        padding: 3px 3px 3px 3px;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      }
    </style>
  </head>
  <body>
    <div id="app">
      <div style="display:flex;">
        <img src="./logo.png" />
        <h3>Replicate Model Import</h3>
      </div>
      <div class="content">
      <p>
        This extension allows any AI model found on <a href='https://replicate.com/explore'>replicate.com</a>.
      </p>
      <label><b>Model</b></label>

      <div><small>Please select a collection to install:</small></div>
      <ul>
      <li><button type="button" onclick="addFavButton('images')">Image Utilities Collection</button>- <small>Image Generation Essentials</small></li>
      <li><button type="button" onclick="addFavButton('SD15')">Stable Diffusion 1.5 Collection</button> - <small>Image Generation and Controlnet</small></li>
      <li><button type="button" onclick="addFavButton('SDXL')">Stable Diffusion XL Collection</button> - <small>Image Generation and Finetunes</small></li>

      </ul>
      <p><small>or</small></p>
      <div><small>Enter Replicate model URL (e.g. https://replicate.com/stability-ai/sdxl) or a valid Model owner and name in the format: owner/modelName, for example <b>stability-ai/sdxl</b></small></div>
      </div>

      <div>
        <input type="text" style="width:300px;" id="modelName" placeholder="e.g. stability-ai/sdxl"> </input>
        </div>

      <button type="button" onclick="addButton()">Add Model To Omnitool</button>
      <p></p>
      <div><small>After adding the model it can be found in the block manager.</small></div>

      <textarea id="result" style="height: 400px; width: 95%; overflow-y: scroll;">

      </textarea>


    </div>
    <script>



      const runExtensionScript = async (scriptName, payload) => {


        await Promise.all(payload.forEach(async (p) => {
          const response = await fetch('/api/v1/mercenaries/runscript/omni-extension-replicate:' + scriptName,
          {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify([p])
          }
        );
        const data = await response.json();

        const replicateResult = data.replicateResult
        const block = data.block

        let resultArea = document.getElementById("result");
        resultArea.value = `${JSON.stringify(replicateResult, null, 2)}`;

        }));

        return data
      }


      const addFavButton = async function(type)
      {

        if (type === 'SDXL')
        {
          runExtensionScript('replicate', ['stability-ai/sdxl', 'fofr/sdxl-emoji', 'fofr/sdxl-barbie', 'pwntus/sdxl-gta-v', 'jakedahn/sdxl-70s-scifi', 'davidbarker/sdxl-polaroid', 'cbh123/sdxl-money','nandycc/sdxl-app-icons'])
        }
        else if (type === 'SD15')
        {
          runExtensionScript('replicate', ['stability-ai/stable-diffusion', 'arielreplicate/paella_fast_outpainting', 'cjwbw/stable-diffusion-high-resolution', 'andreasjansson/stable-diffusion-inpainting', 'rossjillian/controlnet', 'logerzhu/ad-inpaint', 'andreasjansson/qrcode', 'paappraiser/retro-coloring-book'])

        }
        else if (type === 'images')
        {
          runExtensionScript('replicate', ['cjwbw/rembg', 'andreasjansson/deepfloyd-if', 'hassamdevsy/mask2former', 'stphtan94117/auto-remove-anything', 'stphtan94117/auto-blurring-of-faces-and-license_plates', 'tencentarc/gfpgan', 'sczhou/codeformer', 'arielreplicate/deoldify_image', 'lucataco/faceswap', 'nightmareai/real-esrgan', 'jingyunliang/swinir', 'mv-lab/swin2sr', 'nightmareai/latent-sr', 'tencentarc/gfpgan', 'microsoft/bringing-old-photos-back-to-life', 'rmokady/clip_prefix_caption'])
        }
      }


      const addButton = async function()
      {
        const modelName = document.getElementById("modelName").value;

        let name = modelName.trim();

        name = name.replace('https://replicate.com/', '')


        if (name.length == 0)
        {
          alert("Please enter a valid model name in the format: owner/modelName");
          return;
        }

        if (name.indexOf('/') < 1)
        {
          alert("Please enter a valid model name in the format: owner/modelName");
          return;
        }

        runExtensionScript('replicate', [name])
        document.getElementById("modelName").value = ''

      }

      /*const args = new URLSearchParams(location.search)
      const params = JSON.parse(args.get('q'))*/


    </script>
  </body>
</html>
